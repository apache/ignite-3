// Licensed to the Apache Software Foundation (ASF) under one or more
// contributor license agreements.  See the NOTICE file distributed with
// this work for additional information regarding copyright ownership.
// The ASF licenses this file to You under the Apache License, Version 2.0
// (the "License"); you may not use this file except in compliance with
// the License.  You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
= Cluster Configuration Parameters

Ignite 3 cluster configuration is shared across the whole cluster. Regardless of which node you apply the configuration on, it will be propagated to all nodes in the cluster.

In Ignite 3, you can create and maintain configuration in either HOCON or JSON. The configuration file has a single root "node," called `ignite`. All configuration sections are children, grandchildren, etc., of that node.

== Checking Cluster Configuration

To get cluster configuration, use the CLI tool.

- Start the CLI tool and connect to any node in the cluster.
- Run the `cluster config show` command.

The CLI tool will print the full cluster configuration. If you only need a part of the configuration, you can narrow down the search by providing the properties you need as the command argument, for example:

[source, shell]
----
cluster config show ignite.transaction
----

== Changing Cluster Configuration

Cluster configuration is changed from the CLI tool. To change the configuration:

- Start the CLI tool and connect to any node in the cluster.
- Run the `cluster config update` command and provide the updated configuration as the command argument, for example:
+
[source, shell]
----
cluster config update ignite.metaStorage.idleSyncTimeInterval=600
----

The updated configuration will automatically be applied across the cluster,


== Exporting Cluster Configuration

If you need to export cluster configuration to file, use the following command:

[source, shell]
----
bin/ignite3 cluster config show > cluster-config.txt
----

== Configuration Parameters

=== Event Log Configuration

[source, json]
----
{
  "ignite" : {
    "eventlog" : {
      "channels" : [ ],
      "sinks" : [ ]
    }
  }
}
----

[cols="1,1,3,1,1,2",opts="header", stripes=none]
|======
|Property|Default|Description|Changeable|Requires Restart|Acceptable Values
|channels| |A  named list of event log channels.| Yes | No | Valid channels
|sinks| |A named list of event log sinks.| Yes | No | Valid sinks
|======

=== Garbage Collection Configuration

[source, json]
----
{
  "ignite" : {
    "gc" : {
      "batchSize" : 5,
      "lowWatermark" : {
        "dataAvailabilityTime" : 600000,
        "updateInterval" : 300000
      },
      "threads" : 16
    }
  }
}
----

[cols="1,1,3,1,1,2",opts="header", stripes=none]
|======
|Property|Default|Description|Changeable|Requires Restart|Acceptable Values
|batchSize|5|The number of entries to be removed by the garbage collection batch for each partition| Yes | No | 0 - inf
|lowWatermark.dataAvailabilityTime|600000|The duration the outdated versions are available for, in milliseconds.| Yes | No | 1000 - inf
|lowWatermark.updateInterval|300000|The interval of the low watermark updates.| Yes | No | 0 - inf
|threads|Runtime.getRuntime().availableProcessors()|The number of threads used by the garbage collector.| Yes | Yes | 1 - inf
|======

=== Metastorage Configuration

[source, json]
----
{
  "ignite" : {
    "metaStorage" : {
      "idleSyncTimeInterval" : 500
    }
  }
}
----

[cols="1,1,3,1,1,2",opts="header", stripes=none]
|======
|Property|Default|Description|Changeable|Requires Restart|Acceptable Values
|idleSyncTimeInterval|500|Period (in milliseconds) used to determine how often to issue time sync commands when Metastorage is idle (no Writes are issued). Should not exceed schemaSync.delayDuration. The optimal value is schemaSync.delayDuration / 2.| Yes | No (becomes effective on Metastorage leader reelection) | 1 - inf
|======

=== Metrics Configuration

[source, json]
----
{
  "ignite" : {
    "metrics" : {
      "exporters" : [ ]
    }
  }
}
----

[cols="1,1,3,1,1,2",opts="header", stripes=none]
|======
|Property|Default|Description|Changeable|Requires Restart|Acceptable Values
|exporters||The list of link:administrators-guide/metrics/configuring-metrics[metric] exporters currently used.| Yes | No | Valid exporters
|======

=== Replication Configuration

[source, json]
----
{
  "ignite" : {
    "replication" : {
      "idleSafeTimePropagationDuration" : 1000,
      "leaseAgreementAcceptanceTimeLimit" : 120000,
      "leaseExpirationInterval" : 5000,
      "rpcTimeout" : 60000
    }
  }
}
----

[cols="1,1,3,1,1,2",opts="header", stripes=none]
|======
|Property|Default|Description|Changeable|Requires Restart|Acceptable Values
|idleSafeTimePropagationDuration|1000| Interval between Partition Safe Time updates.| No | N/A | 1 - inf
|leaseAgreementAcceptanceTimeLimit|120000| The maximum duration of an election for a new partition leaseholder, in milliseconds. | Yes | N/A | 5000 - inf
|leaseExpirationInterval|5000| The duration of a single lease.| Yes | N/A | 2000 - 120000
|rpcTimeout|60000| Replication request processing timeout.| Yes | No | 0 - inf
|======

=== Schema Sync Configuration

[source, json]
----
{
  "ignite" : {
    "schemaSync" : {
      "delayDuration" : 100,
      "maxClockSkew" : 500
    }
  }
}
----

[cols="1,1,3,1,1,2",opts="header", stripes=none]
|======
|Property|Default|Description|Changeable|Requires Restart|Acceptable Values
|delayDuration|100|The delay after which a schema update becomes active. Should exceed the typical time to deliver a schema update to all cluster nodes, otherwise delays in handling operations are possible. Should not be less than metaStorage.idleSyncTimeInterval. The optimal value is metaStorage.idleSyncTimeInterval * 2.| No | N/A | 1 - inf
|maxClockSkew|500|Maximum physical clock skew (ms) tolerated by the cluster. If the difference between physical clocks of two nodes in the cluster exceeds this value, the cluster might demonstrate abnormal behavior.| No | N/A | 0 - inf
|======

=== Security Configuration

[source, json]
----
{
  "ignite" : {
    "security" : {
      "authentication" : {
        "providers" : [ {
          "name" : "default",
          "type" : "basic",
          "users" : [ {
            "password" : "********",
            "username" : "ignite",
            "displayName" : "ignite"
          }]
        } ]
      }
  }
}
----

[cols="1,1,3,1,1,2",opts="header", stripes=none]
|======
|Property|Default|Description|Changeable|Requires Restart|Acceptable Values
|Authentication parameters|||||
|providers.name|default|The name of the authentication provider.| Yes | No | A valid string
|providers.type|basic|The authentication provider type.| Yes | No | basic, ldap
|providers.users||The list of users registered with the specific provider.|||
|providers.users.displayName|ignite|Case sensitive user name.| No | N/A | A valid username
|providers.users.password|********|User password.| Yes | No | A valid password
|providers.users.username|ignite|Case-insensitive user name.| Yes | No | A valid user name
|Authorization parameters|||||
|======

=== SQL Configuration

[source, json]
----
{
  "ignite" : {
    "sql" : {
      "planner" : {
        "estimatedNumberOfQueries" : 1024,
        "maxPlanningTime" : 15000
      },
      "statementMemoryQuota" : "100%"
    }
  }
}
----

[cols="1,1,3,1,1,2",opts="header", stripes=none]
|======
|Property|Default|Description|Changeable|Requires Restart|Acceptable Values
|planner.estimatedNumberOfQueries|1024|The estimated number of unique queries that are planned to be executed in the cluster in a certain period of time. Used to optimize internal caches and processes. Optional.| Yes | Yes | 0 - Integer.MAX_VALUE
|planner.maxPlanningTime|15000|Query planning timeout in milliseconds. Plan optimization process stops when the timeout is reached. "0" means no timeout.| Yes | Yes | 0 - Long.MAX_VALUE
|statementMemoryQuota|100% a|The amount of memory that can be used by a single SQL statement. A number with a dimension identifier:

* % - percentage of the node's heap memory
* k - Kb
* m - Mb
* g - Gb

"0" with any of he dimension identifiers turns the memory tracking off. | Yes | No a|  * 0-100%

* 0-9223372036854775807k/m/g
|======

=== Storage Update Configuration

[source, json]
----
{
  "ignite" : {
    "storageUpdate" : {
      "batchByteLength" : 8192
    }
  }
}
----

[cols="1,1,3,1,1,2",opts="header", stripes=none]
|======
|Property|Default|Description|Changeable|Requires Restart|Acceptable Values
|batchByteLength|8192|Batch length (in bytes) to be written into physical storage. Used to limit the size of an atomical Write.| Yes | No | 1 - Integer.MAX_VALUE
|======

=== Transactions Configuration

[source, json]
----
{
  "ignite" : {
    "transaction" : {
      "abandonedCheckTs" : 5000,
      "attemptsObtainLock" : 3,
      "implicitTransactionTimeout" : 3000,
      "rpcTimeout" : 60000,
      "txnResourceTtl" : 30000
    }
  }
}
----

[cols="1,1,3,1,1,2",opts="header", stripes=none]
|======
|Property|Default|Description|Changeable|Requires Restart|Acceptable Values

|abandonedCheckTs|5000|The amount of time after which the transaction is considered abandoned.|Yes|Yes|0 - inf
|attemptsObtainLock|3|The number of attempts to obtain a lock. After this number of attempts, a lock conflict exception is thrown on the transaction.| Yes | Yes | 0 - inf
|implicitTransactionTimeout|3000|Timeout for implicit transactions. Used for key-value table APIs invoked with `null` instead of an explicit transaction instance. Must be greater than `rpcTimeout`.| Yes | Yes | 0 - inf
|rpcTimeout|6000|Timeout for the transaction operation. Used for table API operations.| Yes | Yes | 0 - inf
|txnResourceTtl|30000|Time to live for transaction resources (transaction states, transaction nodes, open cursors, etc.). Should be higher than the lag to spread the actual transaction information across clusters. Otherwise, some transaction operations might take more time to find out the state from the persistence storage). Must be greater than `rpcTimeout`.| Yes | Yes | 0 - inf
|======

== System Configuration

This section describes internal properties, which are used by a number of Ignite components. Although you can edit these properties in the same way you edit all others - using the `node config update` CLI command - we suggest that you discuss the proposed changes with the Ignite support team. The properties can apply to the cluster as a whole - see below - or to a link:administrators-guide/config/node-config#system-configuration[specific node].

NOTE: Note that the property names are in `camelCase`.

[source, json]
----
{
  "ignite" : {
    "system" : {
      "cmgPath" : "",
      "metastoragePath" : "",
      "partitionsBasePath" : "",
      "partitionsLogPath" : "",
      "properties":[]
    }
  }
}
----

[cols="1,1,3,1,1,2",opts="header", stripes=none]
|======
|Property|Default|Description|Changeable|Requires Restart|Acceptable Values

|system.cmgPath| The path the cluster management group information is stored to. By default, data is stored in `{IGNITE_HOME}/work/cmg`.| | Yes | Yes | Valid absolute path.
|system.metastoragePath| The path the cluster meta information is stored to. By default, data is stored in `{IGNITE_HOME}/work/metastorage`.| | Yes | Yes | Valid absolute path.
|system.partitionsBasePath| The path data partitions are saved to. By default, partitions are stored in `{IGNITE_HOME}/work/partitions`.| | Yes | Yes | Valid absolute path.
|system.partitionsLogPath| The path RAFT log the partitions are stored at. By default, this log is stored in `{system.partitionsBasePath}/log`.| | Yes | Yes | Valid absolute path.
|system.properties| System properties used by the Ignite components.| | Yes | Yes | An array of properties.
|======