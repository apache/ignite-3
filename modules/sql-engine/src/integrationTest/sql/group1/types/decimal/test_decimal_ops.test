# name: test/sql/types/decimal/test_decimal_ops.test
# description: Test various operations with decimals
# group: [decimal]

statement ok
PRAGMA enable_verification


statement ok
CREATE TABLE decimals_without_params(d DECIMAL);

statement ok
INSERT INTO decimals_without_params values (decimal '1234567890.12345'), (decimal '12345678901234567890123456789.12345');

query I
SELECT * FROM decimals_without_params ORDER BY d
----
1234567890
12345678901234567890123456789


statement ok
CREATE TABLE decimals_without_precision(d DECIMAL(9));

statement error: Numeric field overflow. A field with precision 9, scale 0 must round to an absolute value less than 10^9
INSERT INTO decimals_without_precision values (decimal '1234567890.12345');

statement ok
INSERT INTO decimals_without_precision values (decimal '123456789.12'), (decimal '123456788');

query I
SELECT * FROM decimals_without_precision ORDER BY d
----
123456788
123456789


statement ok
CREATE TABLE decimals(d DECIMAL(3, 2));

statement ok
INSERT INTO decimals VALUES (decimal '0.1'), (decimal '0.2');

# basic projection
query I
SELECT * FROM decimals ORDER BY d
----
0.1
0.2

# ORDER BY
query I
SELECT * FROM decimals ORDER BY d DESC
----
0.2
0.1

# equality
query I
SELECT * FROM decimals WHERE d='0.1'::DECIMAL(3,2)
----
0.1

# greater than equals
query I
SELECT * FROM decimals WHERE d>='0.1'::DECIMAL(3,2) ORDER BY d
----
0.1
0.2

# what about if we use different decimal scales?
query I
SELECT * FROM decimals WHERE d='0.1'::DECIMAL(9,5) ORDER BY d
----
0.1

query I
SELECT * FROM decimals WHERE d >= '0.1'::DECIMAL(9,5) ORDER BY 1
----
0.1
0.2

# what if we compare decimals with different scales and width (3,2) vs (9,1)
statement ok
INSERT INTO decimals VALUES (decimal '0.11'), (decimal '0.21');

query I
SELECT * FROM decimals WHERE d = '0.1'::DECIMAL(9,1)
----
0.1

query I
SELECT * FROM decimals WHERE d > '0.1'::DECIMAL(9,1) ORDER BY 1
----
0.11
0.2
0.21

query I
DELETE FROM decimals WHERE d <> d::DECIMAL(9,1)
----
2

#
# test ABS function
query III
SELECT ABS('-0.1'::DECIMAL(2,1)), ABS('0.1'::DECIMAL(2,1)), ABS(NULL::DECIMAL)
----
0.1	0.1	NULL

query IIII
SELECT ABS('-0.1'::DECIMAL(4,3)), ABS('-0.1'::DECIMAL(9,3)), ABS('-0.1'::DECIMAL(18,3)), ABS('-0.1'::DECIMAL(38,3))
----
0.1	0.1	0.1	0.1

# test CEIL function
query III
SELECT CEIL('0.1'::DECIMAL(2,1)), CEIL('-0.1'::DECIMAL(2,1)), CEIL(NULL::DECIMAL)
----
1	0	NULL

query II
SELECT CEIL('100.3'::DECIMAL(4,1)), CEIL('-127012.3'::DECIMAL(7,1))
----
101	-127012

query II
SELECT CEIL('10.5'::DECIMAL(3,1)), CEIL('-10.5'::DECIMAL(3,1))
----
11	-10

# ceil function on the boundaries
query IIII
SELECT CEIL('999.9'::DECIMAL(4,1)), CEIL('99999999.9'::DECIMAL(9,1)), CEIL('99999999999999999.9'::DECIMAL(18,1)), CEIL('9999999999999999999999999999999999999.9'::DECIMAL(38,1))
----
1000	100000000	100000000000000000	10000000000000000000000000000000000000

query IIII
SELECT CEIL('-999.9'::DECIMAL(4,1)), CEIL('-99999999.9'::DECIMAL(9,1)), CEIL('-99999999999999999.9'::DECIMAL(18,1)), CEIL('-9999999999999999999999999999999999999.9'::DECIMAL(38,1))
----
-999	-99999999	-99999999999999999	-9999999999999999999999999999999999999

# test FLOOR function
query III
SELECT FLOOR(decimal '0.1'), FLOOR(decimal '-0.1'), FLOOR(NULL::DECIMAL)
----
0	-1	NULL

query II
SELECT FLOOR(decimal '100.3'), FLOOR(decimal '-127012.3')
----
100	-127013

query II
SELECT FLOOR(decimal '10.5'), FLOOR(decimal '-10.5')
----
10	-11

# floor function on the boundaries
query IIII
SELECT FLOOR('999.9'::DECIMAL(4,1)), FLOOR('99999999.9'::DECIMAL(9,1)), FLOOR('99999999999999999.9'::DECIMAL(18,1)), FLOOR('9999999999999999999999999999999999999.9'::DECIMAL(38,1))
----
999	99999999	99999999999999999	9999999999999999999999999999999999999

query IIII
SELECT FLOOR('-999.9'::DECIMAL(4,1)), FLOOR('-99999999.9'::DECIMAL(9,1)), FLOOR('-99999999999999999.9'::DECIMAL(18,1)), FLOOR('-9999999999999999999999999999999999999.9'::DECIMAL(38,1))
----
-1000	-100000000	-100000000000000000	-10000000000000000000000000000000000000

# test unary ROUND function
query III
SELECT ROUND(decimal '0.1'), ROUND(decimal '-0.1'), ROUND(NULL::DECIMAL)
----
0	0	NULL

query II
SELECT ROUND(decimal '100.3'), ROUND(decimal '-127012.3')
----
100	-127012

query II
SELECT ROUND(decimal '10.5'), ROUND(decimal '-10.5')
----
11	-11

# round function on the boundaries
query IIII
SELECT ROUND('999.9'::DECIMAL(4,1)), ROUND('99999999.9'::DECIMAL(9,1)), ROUND('99999999999999999.9'::DECIMAL(18,1)), ROUND('9999999999999999999999999999999999999.9'::DECIMAL(38,1))
----
1000	100000000	100000000000000000	10000000000000000000000000000000000000

query IIII
SELECT ROUND('-999.9'::DECIMAL(4,1)), ROUND('-99999999.9'::DECIMAL(9,1)), ROUND('-99999999999999999.9'::DECIMAL(18,1)), ROUND('-9999999999999999999999999999999999999.9'::DECIMAL(38,1))
----
-1000	-100000000	-100000000000000000	-10000000000000000000000000000000000000

# round with precision
query IIIIIIIIIIIII
SELECT ROUND('100.3908147521'::DECIMAL(18,10), 0)::VARCHAR,
	   ROUND('100.3908147521'::DECIMAL(18,10), 1)::VARCHAR,
	   ROUND('100.3908147521'::DECIMAL(18,10), 2)::VARCHAR,
	   ROUND('100.3908147521'::DECIMAL(18,10), 3)::VARCHAR,
	   ROUND('100.3908147521'::DECIMAL(18,10), 4)::VARCHAR,
	   ROUND('100.3908147521'::DECIMAL(18,10), 5)::VARCHAR,
	   ROUND('100.3908147521'::DECIMAL(18,10), 6)::VARCHAR,
	   ROUND('100.3908147521'::DECIMAL(18,10), 7)::VARCHAR,
	   ROUND('100.3908147521'::DECIMAL(18,10), 8)::VARCHAR,
	   ROUND('100.3908147521'::DECIMAL(18,10), 9)::VARCHAR,
	   ROUND('100.3908147521'::DECIMAL(18,10), 10)::VARCHAR,
	   ROUND('100.3908147521'::DECIMAL(18,10), 20)::VARCHAR,
	   ROUND(NULL::DECIMAL, 0)
----
100.0000000000
100.4000000000
100.3900000000
100.3910000000
100.3908000000
100.3908100000
100.3908150000
100.3908148000
100.3908147500
100.3908147520
100.3908147521
100.3908147521
NULL

# negative precision
query IIIIIIIIIIIIIIIIIIIII
SELECT ROUND('1049578239572094512.32415'::DECIMAL(30,10), 0)::VARCHAR,
	   ROUND('1049578239572094512.32415'::DECIMAL(30,10), -1)::VARCHAR,
	   ROUND('1049578239572094512.32415'::DECIMAL(30,10), -2)::VARCHAR,
	   ROUND('1049578239572094512.32415'::DECIMAL(30,10), -3)::VARCHAR,
	   ROUND('1049578239572094512.32415'::DECIMAL(30,10), -4)::VARCHAR,
	   ROUND('1049578239572094512.32415'::DECIMAL(30,10), -5)::VARCHAR,
	   ROUND('1049578239572094512.32415'::DECIMAL(30,10), -6)::VARCHAR,
	   ROUND('1049578239572094512.32415'::DECIMAL(30,10), -7)::VARCHAR,
	   ROUND('1049578239572094512.32415'::DECIMAL(30,10), -8)::VARCHAR,
	   ROUND('1049578239572094512.32415'::DECIMAL(30,10), -9)::VARCHAR,
	   ROUND('1049578239572094512.32415'::DECIMAL(30,10), -10)::VARCHAR,
	   ROUND('1049578239572094512.32415'::DECIMAL(30,10), -11)::VARCHAR,
	   ROUND('1049578239572094512.32415'::DECIMAL(30,10), -12)::VARCHAR,
	   ROUND('1049578239572094512.32415'::DECIMAL(30,10), -13)::VARCHAR,
	   ROUND('1049578239572094512.32415'::DECIMAL(30,10), -14)::VARCHAR,
	   ROUND('1049578239572094512.32415'::DECIMAL(30,10), -15)::VARCHAR,
	   ROUND('1049578239572094512.32415'::DECIMAL(30,10), -16)::VARCHAR,
	   ROUND('1049578239572094512.32415'::DECIMAL(30,10), -18)::VARCHAR,
	   ROUND('1049578239572094512.32415'::DECIMAL(30,10), -19)::VARCHAR,
	   ROUND('1049578239572094512.32415'::DECIMAL(30,10), -20)::VARCHAR,
	   ROUND('1049578239572094512.32415'::DECIMAL(30,10), -19842)::VARCHAR
----
1049578239572094512.0000000000
1049578239572094510.0000000000
1049578239572094500.0000000000
1049578239572095000.0000000000
1049578239572090000.0000000000
1049578239572100000.0000000000
1049578239572000000.0000000000
1049578239570000000.0000000000
1049578239600000000.0000000000
1049578240000000000.0000000000
1049578240000000000.0000000000
1049578200000000000.0000000000
1049578000000000000.0000000000
1049580000000000000.0000000000
1049600000000000000.0000000000
1050000000000000000.0000000000
1050000000000000000.0000000000
1000000000000000000.0000000000
0.0000000000
0.0000000000
0.0000000000

# use decimal in subquery
query I
SELECT (SELECT '1.0'::DECIMAL(2,1));
----
1.0
