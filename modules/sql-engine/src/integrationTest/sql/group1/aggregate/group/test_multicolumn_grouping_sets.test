# name: test/sql/aggregate/group/test_grouping_sets.test
# description: Test group by with rollup and cube
# feature: T431 (GROUPING operation), T433 (Multiargument GROUPING function)
# group: [group]

query IIIII
SELECT GROUPING(a, b) as g1, GROUPING(a, c) as g2, GROUPING(b, c) as g3, GROUPING(a) as g4, GROUPING(a, b, c) as g5
FROM (VALUES (1, 2, 3), (4, NULL, 6), (1, NULL, 6)) AS t (a, b, c)
GROUP BY GROUPING SETS ((a, b), (a, c), (b, c))
ORDER BY g1, g2, g3
----
0	0	1	0	0
0	0	1	0	0
0	1	0	0	0
0	1	0	0	0
0	1	0	0	0
1	0	0	0	0
1	0	0	0	0
1	0	0	0	0

query III
SELECT GROUPING(a) as g1, GROUPING(a, b, c) as g2, GROUPING(a, b) as g3
FROM (VALUES (1, 2, 3), (4, NULL, 6), (1, NULL, 6)) AS t (a, b, c)
GROUP BY GROUPING SETS ((a), (b), (a, b, c))
ORDER BY g1, g2, g3
----
0	0	0
0	0	0
0	1	0
0	1	0
0	1	0
1	0	0
1	0	0

query IIRR
SELECT GROUPING(category_id, city_id) as city, GROUPING(city_id, category_id), min(price) as price_min, max(price) as price_max
FROM (VALUES
(2, 6, 21500.00),
(2, 6, 22900.00),
(2, 6, 23500.00),
(2, 7, 17800.00),
(4, 6, 20000.00),
(4, 8, 37000.00),
(4, 9, 75600.00)
) AS t (city_id, category_id, price)
GROUP BY GROUPING SETS ((city_id, category_id))
ORDER BY city, price_min, price_max
----
1	1	17800.00	17800.00
1	1	20000.00	20000.00
1	1	21500.00	23500.00
1	1	37000.00	37000.00
1	1	75600.00	75600.00

# https://issues.apache.org/jira/browse/IGNITE-25919 Failed to rewrite to union.
query IIIT rowsort
SELECT GROUPING(val), GROUPING(id, val), id, val
FROM ( VALUES
('c4a0327c-44be-416d-ae90-75c05079789f'::UUID, 1),
('367fc6f1-40c3-4237-8545-3fd102d29134'::UUID, 2)
) as t(val, id)
GROUP BY ALL GROUPING SETS ((val, id), (id, val))
----
0	1	1	c4a0327c-44be-416d-ae90-75c05079789f
0	1	1	c4a0327c-44be-416d-ae90-75c05079789f
0	1	2	367fc6f1-40c3-4237-8545-3fd102d29134
0	1	2	367fc6f1-40c3-4237-8545-3fd102d29134
