# name: test/sql/aggregate/group/test_grouping_sets.test
# description: Test group by with rollup and cube
# feature: T431 (GROUPING operation), T433 (Multiargument GROUPING function)
# group: [group]

query IIII rowsort
SELECT GROUPING(a), GROUPING(b), GROUPING(c), GROUPING(a, b, c)
FROM (VALUES (1, 2, 3), (1, NULL, 3)) AS t (a, b, c)
GROUP BY GROUPING SETS ((a), (a, b), (a, b, c))
----
1	0	0	4
1	1	0	6
1	1	0	6
1	1	1	7
1	1	1	7

query IIII rowsort
SELECT GROUPING(a), GROUPING(b), GROUPING(c), GROUPING(a, b, c)
FROM (VALUES (1, 2, 3), (1, NULL, 3)) AS t (a, b, c)
GROUP BY GROUPING SETS ((a), (b, c), ())
----
1	0	0	4
0	1	1	3
0	1	1	3
0	0	0	0

query III rowsort
SELECT GROUPING(a), GROUPING(a, b), GROUPING(a, b, c)
FROM (VALUES (1, 2, 3), (1, NULL, 3)) AS t (a, b, c)
GROUP BY GROUPING SETS ((a, b), (a, c), (b, c))
----
1	3	6
1	3	6
1	2	5
0	1	3
0	1	3

query IIIII rowsort
SELECT GROUPING(a, b), GROUPING(a, c), GROUPING(b, c), GROUPING(a), GROUPING(a, b, c)
FROM (VALUES (1, 2, 3), (1, NULL, 3)) AS t (a, b, c)
GROUP BY GROUPING SETS ((a, b), (a, c), (b, c))
----
3	2	2	1	6
3	2	2	1	6
2	3	1	1	5
1	1	3	0	3
1	1	3	0	3

query IIIII rowsort
SELECT GROUPING(a, b), GROUPING(a, b, c), a, b, c
FROM (VALUES (1, 2, 3), (1, NULL, 3)) AS t (a, b, c)
GROUP BY GROUPING SETS ((a), (a, b), (a, c), (a, b, c))
----
2	4	1	NULL	NULL
3	6	1	2	NULL
3	6	1	NULL	NULL
2	5	1	NULL	3
3	7	1	2	3
3	7	1	NULL	3

query IIRR rowsort
SELECT GROUPING(category_id, city_id) as city, GROUPING(city_id, category_id), min(price) as price_min, max(price) as price_max
FROM (VALUES
(2, 6, 21500.00),
(2, 6, 22900.00),
(2, 6, 23500.00),
(2, 7, 17800.00),
(4, 6, 20000.00),
(4, 8, 37000.00),
(4, 9, 75600.00)
) AS t (city_id, category_id, price)
GROUP BY GROUPING SETS ((city_id, category_id))
----
3	3	17800.00	17800.00
3	3	20000.00	20000.00
3	3	21500.00	23500.00
3	3	37000.00	37000.00
3	3	75600.00	75600.00

skipif ignite3
# https://issues.apache.org/jira/browse/IGNITE-26335 Conversion to relational algebra failed to preserve datatypes
query IIIT rowsort
SELECT GROUPING(val), GROUPING(id, val), id, val
FROM ( VALUES
('c4a0327c-44be-416d-ae90-75c05079789f'::UUID, 1),
('367fc6f1-40c3-4237-8545-3fd102d29134'::UUID, 2)
) as t(val, id)
GROUP BY ALL GROUPING SETS ((val, id))
----
1	3	1	c4a0327c-44be-416d-ae90-75c05079789f
1	3	2	367fc6f1-40c3-4237-8545-3fd102d29134

skipif ignite3
# https://issues.apache.org/jira/browse/IGNITE-26335 Rewriting GROUPING SETS to UNION failed with AssertionError during conversion from AST
query IIIT rowsort
SELECT GROUPING(val), GROUPING(id, val), id, val
FROM ( VALUES
('c4a0327c-44be-416d-ae90-75c05079789f'::UUID, 1),
('367fc6f1-40c3-4237-8545-3fd102d29134'::UUID, 2)
) as t(val, id)
GROUP BY ALL GROUPING SETS ((val, id), (id, val))
----
1	3	1	c4a0327c-44be-416d-ae90-75c05079789f
1	3	2	367fc6f1-40c3-4237-8545-3fd102d29134
1	3	1	c4a0327c-44be-416d-ae90-75c05079789f
1	3	2	367fc6f1-40c3-4237-8545-3fd102d29134
