# description: Tests for: 'explain mapping for' command.
# Mapped fragments need to be placed inside "----" divisors.

statement ok
CREATE TABLE test_table (c1 INT PRIMARY KEY, c2 INT, c3 INT);

explain mapping
SELECT /*+ DISABLE_RULE('MapReduceSortAggregateConverterRule',
                        'ColocatedSortAggregateConverterRule',
                        'MapReduceHashAggregateConverterRule') */ COUNT(*) FROM SYSTEM.SYSTEM_VIEWS;
----
Fragment#0 root
  distribution: single
  executionNodes: [sqllogic0]
  tree: 
    ColocatedHashAggregate
        fieldNames: [EXPR$0]
        group: []
        aggregation: [COUNT()]
        est: (rows=1)
      SystemViewScan
          table: SYSTEM.SYSTEM_VIEWS
          fieldNames: [VIEW_ID, SCHEMA_NAME, VIEW_NAME, VIEW_TYPE, ID, SCHEMA, NAME, TYPE]
          est: (rows=100)
----

explain mapping
SELECT * FROM test_table WHERE c1 = 1
----
Fragment#0 root
  distribution: single
  executionNodes: [sqllogic0]
  tree: 
    KeyValueGet
        table: PUBLIC.TEST_TABLE
        fieldNames: [C1, C2, C3]
        key: [1]
        est: (rows=1)
----

explain mapping
SELECT COUNT(*) FROM test_table
----
Fragment#0 root
  distribution: single
  executionNodes: [sqllogic0]
  tree: 
    SelectCount
        table: PUBLIC.TEST_TABLE
        fieldNames: [$f0]
        projection: [$COUNT_ALL]
        est: (rows=1)
----

explain mapping
INSERT INTO test_table VALUES (1, 2, 3)
----
Fragment#0 root
  distribution: any
  executionNodes: [sqllogic0]
  tree: 
    KeyValueModify
        table: PUBLIC.TEST_TABLE
        fieldNames: [ROWCOUNT]
        sourceExpression: [1, 2, 3]
        type: INSERT
        est: (rows=1)
----

explain mapping
SELECT c1 FROM (VALUES(1), (2)) t(c1)
----
Fragment#0 root
  distribution: broadcast
  executionNodes: [sqllogic0]
  tree: 
    Values
        fieldNames: [C1]
        tuples: [[1], [2]]
        est: (rows=2)
----
